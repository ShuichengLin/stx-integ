From bea6513a83c05acdd4d5947b43f34e499923130e Mon Sep 17 00:00:00 2001
From: Kam Nasim <kam.nasim@windriver.com>
Date: Fri, 12 Jan 2018 11:44:29 -0500
Subject: [PATCH] export module signing key in kernel devel

---
 SPECS/kernel-rt.spec | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/SPECS/kernel-rt.spec b/SPECS/kernel-rt.spec
index 298ce17..4935d51 100644
--- a/SPECS/kernel-rt.spec
+++ b/SPECS/kernel-rt.spec
@@ -1131,6 +1131,12 @@ BuildKernel() {
     cp signing_key.priv signing_key.priv.sign${Flavour:+.${Flavour}}
     cp signing_key.x509 signing_key.x509.sign${Flavour:+.${Flavour}}
 
+    # WRS: Copy these keys as part of the devel package
+    # The Module signing keys are to ensure that only Out-of-tree
+    # built against the Titanium Kernel get signed and loaded sans warnings
+    cp signing_key.priv ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+    cp signing_key.x509 ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+
     # remove files that will be auto generated by depmod at rpm -i time
     for i in alias alias.bin builtin.bin ccwmap dep dep.bin ieee1394map inputmap isapnpmap ofmap pcimap seriomap symbols symbols.bin usbmap softdep devname
     do
-- 
1.8.3.1

