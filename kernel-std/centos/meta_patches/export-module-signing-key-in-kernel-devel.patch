From ebc3ffc011206683e0351078fbc5bf1fd2c57047 Mon Sep 17 00:00:00 2001
From: Kam Nasim <kam.nasim@windriver.com>
Date: Wed, 10 Jan 2018 17:34:42 -0500
Subject: [PATCH] export module signing key in kernel devel

---
 SPECS/kernel.spec | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/SPECS/kernel.spec b/SPECS/kernel.spec
index decef93..708b04c 100644
--- a/SPECS/kernel.spec
+++ b/SPECS/kernel.spec
@@ -1155,6 +1155,12 @@ BuildKernel() {
     cp signing_key.priv signing_key.priv.sign${Flavour:+.${Flavour}}
     cp signing_key.x509 signing_key.x509.sign${Flavour:+.${Flavour}}
 
+    # WRS: Copy these keys as part of the devel package
+    # The Module signing keys are to ensure that only Out-of-tree
+    # built against the Titanium Kernel get signed and loaded sans warnings
+    cp signing_key.priv ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+    cp signing_key.x509 ${RPM_BUILD_ROOT}/lib/modules/${KernelVer}/build/
+
     # remove files that will be auto generated by depmod at rpm -i time
     for i in alias alias.bin builtin.bin ccwmap dep dep.bin ieee1394map inputmap isapnpmap ofmap pcimap seriomap symbols symbols.bin usbmap softdep devname
     do
-- 
1.8.3.1

